# ğŸ“Š å·¥ä½œæµç³»ç»Ÿ - æ•°æ®åº“åˆå§‹åŒ–æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ å‡†å¤‡å·¥ä½œ

ç¡®ä¿æ‚¨å·²å®‰è£…ï¼š
- âœ… MySQL 8.0+
- âœ… JDK 17+
- âœ… Maven 3.8+

### 2ï¸âƒ£ åˆ›å»ºæ•°æ®åº“

```sql
-- ç™»å½• MySQL
mysql -u root -p

-- åˆ›å»ºæ•°æ®åº“ï¼ˆä½¿ç”¨ utf8mb4 å­—ç¬¦é›†ï¼‰
CREATE DATABASE IF NOT EXISTS workflow_db 
    DEFAULT CHARACTER SET utf8mb4 
    COLLATE utf8mb4_unicode_ci;

-- éªŒè¯æ•°æ®åº“
SHOW DATABASES LIKE 'workflow_db';

-- é€€å‡º
EXIT;
```

### 3ï¸âƒ£ é…ç½®æ•°æ®åº“è¿æ¥

ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š`backend/workflow-start/src/main/resources/application-dev.yml`

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/workflow_db?serverTimezone=Asia/Shanghai&characterEncoding=utf8mb4&useSSL=false&allowPublicKeyRetrieval=true
    username: root           # ä¿®æ”¹ä¸ºæ‚¨çš„æ•°æ®åº“ç”¨æˆ·å
    password: your_password  # ä¿®æ”¹ä¸ºæ‚¨çš„æ•°æ®åº“å¯†ç 
    driver-class-name: com.mysql.cj.jdbc.Driver
```

### 4ï¸âƒ£ å¯åŠ¨åº”ç”¨ï¼ˆè‡ªåŠ¨åˆå§‹åŒ–ï¼‰

```bash
# è¿›å…¥åç«¯å¯åŠ¨æ¨¡å—
cd backend/workflow-start

# å¯åŠ¨åº”ç”¨ï¼ˆFlyway ä¼šè‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–ï¼‰
mvn spring-boot:run

# æˆ–è€…å…ˆç¼–è¯‘æ‰“åŒ…
cd ../
mvn clean package -DskipTests
cd workflow-start
java -jar target/workflow-start-1.0.0-SNAPSHOT.jar
```

**å¯åŠ¨æ—¶æ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼æ—¥å¿—ï¼š**
```
INFO  Flyway - Database: jdbc:mysql://localhost:3306/workflow_db
INFO  Flyway - Successfully validated 2 migrations
INFO  Flyway - Creating Schema History table `workflow_db`.`flyway_schema_history` ...
INFO  Flyway - Current version of schema `workflow_db`: << Empty Schema >>
INFO  Flyway - Migrating schema `workflow_db` to version "1 - init tables"
INFO  Flyway - Migrating schema `workflow_db` to version "2 - init data"
INFO  Flyway - Successfully applied 2 migrations to schema `workflow_db`
```

### 5ï¸âƒ£ éªŒè¯æ•°æ®åº“

```sql
-- ç™»å½•æ•°æ®åº“
mysql -u root -p workflow_db

-- æŸ¥çœ‹ Flyway è¿ç§»å†å²
SELECT installed_rank, version, description, installed_on, success 
FROM flyway_schema_history 
ORDER BY installed_rank;

-- æŸ¥çœ‹ä¸šåŠ¡è¡¨ï¼ˆåº”è¯¥æœ‰ 15 å¼ ï¼‰
SHOW TABLES LIKE 'wf_%';
SHOW TABLES LIKE 'sys_%';

-- æŸ¥çœ‹ Flowable å¼•æ“è¡¨ï¼ˆåº”è¯¥æœ‰çº¦ 70 å¼ ï¼‰
SHOW TABLES LIKE 'ACT_%';
SHOW TABLES LIKE 'FLW_%';

-- æŸ¥çœ‹è¡¨æ€»æ•°
SELECT COUNT(*) AS table_count 
FROM information_schema.tables 
WHERE table_schema = 'workflow_db';

-- éªŒè¯åˆå§‹æ•°æ®
SELECT username, real_name, status FROM sys_user;
SELECT role_name, role_code FROM sys_role;
SELECT category_name, category_code FROM wf_process_category;
```

**é¢„æœŸç»“æœï¼š**
- âœ… ä¸šåŠ¡è¡¨ï¼š15 å¼ 
- âœ… Flowable è¡¨ï¼šçº¦ 70 å¼ 
- âœ… é»˜è®¤ç”¨æˆ·ï¼š1 ä¸ªï¼ˆadminï¼‰
- âœ… é»˜è®¤è§’è‰²ï¼š3 ä¸ª
- âœ… é»˜è®¤æµç¨‹åˆ†ç±»ï¼š6 ä¸ª

---

## ğŸ“‚ æ•°æ®åº“è„šæœ¬è¯´æ˜

æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ä½äºï¼š`backend/workflow-start/src/main/resources/db/migration/`

### V1__init_tables.sql - è¡¨ç»“æ„åˆå§‹åŒ–

åˆ›å»º 15 å¼ ä¸šåŠ¡è¡¨ï¼š

#### ğŸ”„ æµç¨‹ç›¸å…³è¡¨ï¼ˆ4å¼ ï¼‰
1. **wf_process_category** - æµç¨‹åˆ†ç±»è¡¨
2. **wf_process_definition_ext** - æµç¨‹å®šä¹‰æ‰©å±•è¡¨
3. **wf_process_instance_ext** - æµç¨‹å®ä¾‹æ‰©å±•è¡¨
4. **wf_task_ext** - ä»»åŠ¡æ‰©å±•è¡¨

#### ğŸ“ è¡¨å•ç›¸å…³è¡¨ï¼ˆ3å¼ ï¼‰
5. **wf_form_definition** - è¡¨å•å®šä¹‰è¡¨
6. **wf_form_field** - è¡¨å•å­—æ®µè¡¨
7. **wf_form_instance** - è¡¨å•å®ä¾‹è¡¨

#### ğŸ‘¥ ç»„ç»‡æƒé™è¡¨ï¼ˆ7å¼ ï¼‰
8. **sys_org** - ç»„ç»‡æ¶æ„è¡¨
9. **sys_user** - ç”¨æˆ·è¡¨
10. **sys_role** - è§’è‰²è¡¨
11. **sys_user_role** - ç”¨æˆ·è§’è‰²å…³è”è¡¨
12. **sys_permission** - æƒé™è¡¨
13. **sys_role_permission** - è§’è‰²æƒé™å…³è”è¡¨

#### ğŸ“Š ç›‘æ§ç»Ÿè®¡è¡¨ï¼ˆ2å¼ ï¼‰
14. **wf_process_monitor_log** - æµç¨‹ç›‘æ§æ—¥å¿—è¡¨
15. **wf_process_performance_stat** - æµç¨‹æ€§èƒ½ç»Ÿè®¡è¡¨

**æ³¨æ„ï¼š** Flowable å¼•æ“è¡¨ï¼ˆçº¦ 70 å¼ ï¼‰ç”± Flowable è‡ªåŠ¨åˆ›å»ºã€‚

### V2__init_data.sql - åˆå§‹æ•°æ®

#### æµç¨‹åˆ†ç±»æ•°æ®ï¼ˆ6æ¡ï¼‰
- åŠå…¬æµç¨‹ã€è´¢åŠ¡æµç¨‹ã€äººäº‹æµç¨‹
- é‡‡è´­æµç¨‹ã€é”€å”®æµç¨‹ã€å…¶ä»–æµç¨‹

#### ç³»ç»Ÿç”¨æˆ·ï¼ˆ1ä¸ªï¼‰
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`ï¼ˆMD5 åŠ å¯†ï¼‰
- è§’è‰²ï¼šç³»ç»Ÿç®¡ç†å‘˜

#### ç³»ç»Ÿè§’è‰²ï¼ˆ3ä¸ªï¼‰
- ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆADMINï¼‰
- æµç¨‹ç®¡ç†å‘˜ï¼ˆPROCESS_ADMINï¼‰
- æ™®é€šç”¨æˆ·ï¼ˆUSERï¼‰

#### ç³»ç»Ÿæƒé™ï¼ˆè‹¥å¹²ï¼‰
- ç”¨æˆ·ç®¡ç†ã€è§’è‰²ç®¡ç†ã€æƒé™ç®¡ç†
- æµç¨‹è®¾è®¡ã€æµç¨‹éƒ¨ç½²ã€æµç¨‹ç›‘æ§
- ä»»åŠ¡å¤„ç†ã€è¡¨å•è®¾è®¡ç­‰

---

## ğŸ”§ æ‰‹åŠ¨åˆå§‹åŒ–ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸æƒ³ä½¿ç”¨ Flyway è‡ªåŠ¨è¿ç§»ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬ï¼š

```bash
# 1. åˆ›å»ºæ•°æ®åº“
mysql -u root -p -e "CREATE DATABASE IF NOT EXISTS workflow_db DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 2. æ‰§è¡Œè¡¨ç»“æ„è„šæœ¬
mysql -u root -p workflow_db < backend/workflow-start/src/main/resources/db/migration/V1__init_tables.sql

# 3. æ‰§è¡Œåˆå§‹æ•°æ®è„šæœ¬
mysql -u root -p workflow_db < backend/workflow-start/src/main/resources/db/migration/V2__init_data.sql

# 4. ç¦ç”¨ Flywayï¼ˆä¿®æ”¹ application.ymlï¼‰
# spring:
#   flyway:
#     enabled: false
```

---

## ğŸ“Š Flowable å¼•æ“è¡¨è¯´æ˜

Flowable ä¼šè‡ªåŠ¨åˆ›å»ºçº¦ 70 å¼ è¡¨ï¼Œä¸»è¦åˆ†ä¸ºï¼š

### æµç¨‹å®šä¹‰è¡¨ï¼ˆACT_RE_*ï¼‰
- `ACT_RE_DEPLOYMENT` - éƒ¨ç½²ä¿¡æ¯
- `ACT_RE_PROCDEF` - æµç¨‹å®šä¹‰
- `ACT_RE_MODEL` - æµç¨‹æ¨¡å‹

### è¿è¡Œæ—¶è¡¨ï¼ˆACT_RU_*ï¼‰
- `ACT_RU_EXECUTION` - æµç¨‹å®ä¾‹/æ‰§è¡Œæµ
- `ACT_RU_TASK` - å¾…åŠä»»åŠ¡
- `ACT_RU_VARIABLE` - æµç¨‹å˜é‡
- `ACT_RU_IDENTITYLINK` - ä»»åŠ¡å‚ä¸è€…

### å†å²è¡¨ï¼ˆACT_HI_*ï¼‰
- `ACT_HI_PROCINST` - å†å²æµç¨‹å®ä¾‹
- `ACT_HI_TASKINST` - å†å²ä»»åŠ¡
- `ACT_HI_ACTINST` - å†å²æ´»åŠ¨èŠ‚ç‚¹
- `ACT_HI_VARINST` - å†å²å˜é‡

### èº«ä»½è¡¨ï¼ˆACT_ID_*ï¼‰
- `ACT_ID_USER` - ç”¨æˆ·
- `ACT_ID_GROUP` - ç»„
- `ACT_ID_MEMBERSHIP` - ç”¨æˆ·ç»„å…³ç³»

### é€šç”¨è¡¨ï¼ˆACT_GE_*ï¼‰
- `ACT_GE_BYTEARRAY` - äºŒè¿›åˆ¶æ•°æ®
- `ACT_GE_PROPERTY` - ç³»ç»Ÿå±æ€§

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: å¯åŠ¨æ—¶æŠ¥é”™ "Unknown database 'workflow_db'"

**è§£å†³æ–¹æ¡ˆï¼š** å…ˆæ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“
```sql
CREATE DATABASE IF NOT EXISTS workflow_db 
    DEFAULT CHARACTER SET utf8mb4 
    COLLATE utf8mb4_unicode_ci;
```

### Q2: å¯åŠ¨æ—¶æŠ¥é”™ "Access denied for user 'root'@'localhost'"

**è§£å†³æ–¹æ¡ˆï¼š** æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
```yaml
spring:
  datasource:
    username: root          # ç¡®è®¤ç”¨æˆ·å
    password: your_password # ç¡®è®¤å¯†ç 
```

### Q3: è¡¨å·²å­˜åœ¨ï¼Œå¦‚ä½•é‡æ–°åˆå§‹åŒ–ï¼Ÿ

**æ–¹æ¡ˆ 1ï¼šåˆ é™¤å¹¶é‡å»ºæ•°æ®åº“**
```sql
DROP DATABASE workflow_db;
CREATE DATABASE workflow_db DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

**æ–¹æ¡ˆ 2ï¼šæ¸…ç©º Flyway å†å²é‡æ–°è¿ç§»**
```sql
-- åˆ é™¤æ‰€æœ‰è¡¨
DROP DATABASE workflow_db;
CREATE DATABASE workflow_db DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- æˆ–è€…åªåˆ é™¤ Flyway å†å²è¡¨
DELETE FROM flyway_schema_history;
```

### Q4: ä¸­æ–‡ä¹±ç é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š** ç¡®ä¿æ‰€æœ‰ç¯èŠ‚ä½¿ç”¨ utf8mb4
- æ•°æ®åº“å­—ç¬¦é›†ï¼š`utf8mb4`
- JDBC è¿æ¥å‚æ•°ï¼š`characterEncoding=utf8mb4`
- è¡¨å­—ç¬¦é›†ï¼š`DEFAULT CHARSET=utf8mb4`

### Q5: Flowable è¡¨æ²¡æœ‰åˆ›å»º

**åŸå› ï¼š** å¯èƒ½ Flowable é…ç½®æœ‰é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š** æ£€æŸ¥é…ç½®
```yaml
spring:
  datasource:
    # ç¡®ä¿æ•°æ®æºé…ç½®æ­£ç¡®
  
flowable:
  database-schema-update: true  # è‡ªåŠ¨æ›´æ–°è¡¨ç»“æ„
  async-executor-activate: true
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸåï¼š

1. âœ… **å¯åŠ¨åç«¯**
   ```bash
   cd backend/workflow-start
   mvn spring-boot:run
   # è®¿é—®ï¼šhttp://localhost:8080
   ```

2. âœ… **å¯åŠ¨å‰ç«¯**
   ```bash
   cd frontend
   npm install
   npm run dev
   # è®¿é—®ï¼šhttp://localhost:3000
   ```

3. âœ… **ç™»å½•ç³»ç»Ÿ**
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼š`admin123`

4. âœ… **å¼€å§‹å¼€å‘**
   - æŸ¥çœ‹ [é¡¹ç›®å¿«é€Ÿå¯åŠ¨æŒ‡å—](QUICK_START.md)
   - æŸ¥çœ‹ [å¼€å‘è®¡åˆ’](doc/04-é¡¹ç›®å®æ–½è·¯çº¿å›¾.md)

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- ğŸ“– [é¡¹ç›®æ–‡æ¡£](doc/)
- ğŸ“ [å¿«é€Ÿå¯åŠ¨æŒ‡å—](QUICK_START.md)
- ğŸ”§ [é¡¹ç›®è®¾ç½®æŒ‡å—](PROJECT_SETUP_GUIDE.md)

---

**ç¥æ‚¨å¼€å‘é¡ºåˆ©ï¼ğŸ‰**

