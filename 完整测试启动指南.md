# 🚀 完整测试启动指南

## ✅ 问题已解决

### npm install 错误已修复

**问题**：`form-create@^3.2.0` 找不到匹配版本

**原因**：`package.json` 中包含了 MVP2 阶段才需要的依赖包

**解决方案**：已移除以下依赖
- ❌ `bpmn-js` - 流程设计器（MVP2）
- ❌ `bpmn-js-properties-panel` - 流程设计器属性面板（MVP2）
- ❌ `form-create` - 表单设计器（MVP2）
- ❌ `@form-create/element-ui` - 表单设计器UI（MVP2）
- ❌ `echarts` - 图表库（MVP2）
- ❌ `dayjs` - 日期库（暂不需要）
- ❌ `lodash-es` - 工具库（暂不需要）
- ❌ `nprogress` - 进度条（暂不需要）
- ❌ `js-cookie` - Cookie管理（暂不需要）

**保留的核心依赖**：
- ✅ `vue` - 核心框架
- ✅ `vue-router` - 路由管理
- ✅ `pinia` - 状态管理
- ✅ `element-plus` - UI组件库
- ✅ `@element-plus/icons-vue` - 图标库
- ✅ `axios` - HTTP客户端

---

## 🧪 任务 A：测试历史查询API

### 步骤 1：重启后端服务

**重要**：新增的历史查询API需要重启后端才能生效！

```bash
# 停止当前运行的后端（Ctrl+C）
# 然后重新启动
cd /Users/yanchao/IdeaProjects/workFolw/backend
mvn spring-boot:run
```

等待看到：
```
Started WorkFlowApplication in X.XXX seconds
Tomcat started on port(s): 9099 (http)
```

---

### 步骤 2：测试新增的历史查询API

#### 2.1 获取Token

```bash
TOKEN=$(curl -s -X POST http://localhost:9099/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' | \
  grep -o '"accessToken":"[^"]*' | grep -o '[^"]*$')

echo "Token: ${TOKEN:0:50}..."
```

#### 2.2 测试历史流程实例列表

```bash
# 查询所有历史流程
curl -X GET "http://localhost:9099/api/process/history/instances?pageNum=1&pageSize=10" \
  -H "Authorization: Bearer $TOKEN" | python3 -m json.tool
```

**预期返回**：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "list": [],
    "total": 0,
    "pageNum": 1,
    "pageSize": 10,
    "totalPages": 0
  }
}
```

#### 2.3 测试已完成流程查询

```bash
curl -X GET "http://localhost:9099/api/process/history/instances?finished=true&pageNum=1&pageSize=10" \
  -H "Authorization: Bearer $TOKEN" | python3 -m json.tool
```

#### 2.4 测试未完成流程查询

```bash
curl -X GET "http://localhost:9099/api/process/history/instances?finished=false&pageNum=1&pageSize=10" \
  -H "Authorization: Bearer $TOKEN" | python3 -m json.tool
```

#### 2.5 测试流程执行轨迹查询（需要实际的instanceId）

```bash
# 如果有实际的流程实例ID，替换 INSTANCE_ID
curl -X GET "http://localhost:9099/api/process/history/instance/INSTANCE_ID/activities" \
  -H "Authorization: Bearer $TOKEN" | python3 -m json.tool
```

---

## 🌐 任务 B：启动前端并完整测试

### 步骤 1：启动前端（已启动）

```bash
cd /Users/yanchao/IdeaProjects/workFolw/frontend
npm run dev
```

等待看到：
```
VITE v5.x.x  ready in xxx ms

➜  Local:   http://localhost:5173/
➜  Network: use --host to expose
```

---

### 步骤 2：浏览器测试

#### 2.1 打开浏览器

访问：**http://localhost:5173**

应该自动跳转到登录页面。

#### 2.2 登录系统

- **用户名**：`admin`
- **密码**：`admin123`
- 点击"登录"或按回车

**预期**：
- ✅ 显示"登录成功"提示
- ✅ 跳转到首页
- ✅ 顶部显示用户名"系统管理员"

#### 2.3 测试流程实例列表

1. 点击左侧菜单："流程管理" → "流程实例"
2. 页面应显示"流程实例列表"
3. 当前列表为空（正常，因为还没有流程实例）

**测试功能**：
- ✅ 搜索框输入测试
- ✅ 分页切换
- ✅ 下拉选择状态筛选

#### 2.4 测试待办任务列表

1. 点击左侧菜单："任务管理" → "待办任务"
2. 页面应显示"待办任务列表"
3. 右上角显示"0 个待办"

**测试功能**：
- ✅ 搜索功能
- ✅ 分页功能
- ✅ 数据为空提示

#### 2.5 测试已办任务列表

1. 点击左侧菜单："任务管理" → "已办任务"
2. 页面应显示"已办任务列表"
3. 右上角显示"共 0 个"

---

### 步骤 3：浏览器开发者工具检查

**按 F12 打开开发者工具**

#### 3.1 检查 Network（网络）

切换到 "Network" 标签页，刷新页面：

✅ **应该看到**：
- `/api/auth/current` - 200 OK
- `/api/process/instances?pageNum=1&pageSize=10` - 200 OK
- `/api/task/list?taskStatus=todo...` - 200 OK
- 所有请求头都有 `Authorization: Bearer xxx`

❌ **不应该看到**：
- 401 Unauthorized
- 500 Internal Server Error
- CORS 错误

#### 3.2 检查 Console（控制台）

切换到 "Console" 标签页：

✅ **应该看到**：
- Vue 相关的日志（如果有）
- 正常的应用日志

❌ **不应该看到**：
- 红色的错误信息
- CORS 错误
- 404 错误

---

## 📊 测试结果验证

### 后端API测试

| 测试项 | 接口 | 预期结果 | 实际结果 |
|--------|------|---------|---------|
| 登录 | POST /api/auth/login | 200 + Token | ⬜ |
| 查询历史流程列表 | GET /api/process/history/instances | 200 + 空列表 | ⬜ |
| 查询已完成流程 | GET /api/process/history/instances?finished=true | 200 + 空列表 | ⬜ |
| 查询未完成流程 | GET /api/process/history/instances?finished=false | 200 + 空列表 | ⬜ |

### 前端功能测试

| 测试项 | 页面 | 预期结果 | 实际结果 |
|--------|------|---------|---------|
| 登录 | /login | 登录成功，跳转首页 | ⬜ |
| 流程列表 | /process/instance | 显示空列表 | ⬜ |
| 待办任务 | /task/todo | 显示0个待办 | ⬜ |
| 已办任务 | /task/done | 显示0个已办 | ⬜ |
| 路由守卫 | 未登录访问 | 跳转登录页 | ⬜ |

---

## 🎯 完整测试流程（推荐）

### 自动化测试脚本

```bash
cd /Users/yanchao/IdeaProjects/workFolw
./test-backend-api.sh
```

**预期输出**：
```
✓ 通过的测试: 11
✗ 失败的测试: 0
总测试数: 11

所有测试通过！后端API运行正常！
```

---

## 📝 测试中可能遇到的问题

### 问题 1：后端 500 错误

**症状**：历史查询API返回500错误

**原因**：后端代码未重新编译或未重启

**解决**：
```bash
# 停止后端（Ctrl+C）
cd backend
mvn clean compile
mvn spring-boot:run
```

### 问题 2：前端页面白屏

**症状**：浏览器显示空白页面

**原因**：前端依赖未安装或版本不兼容

**解决**：
```bash
cd frontend
rm -rf node_modules package-lock.json
npm install
npm run dev
```

### 问题 3：Token 未携带

**症状**：401 Unauthorized

**原因**：Token未保存或请求拦截器未生效

**解决**：
1. 清除浏览器 localStorage
2. 重新登录
3. 检查 Network 请求头

### 问题 4：端口被占用

**症状**：
- 后端：Port 9099 was already in use
- 前端：Port 5173 was already in use

**解决**：
```bash
# 检查占用端口的进程
lsof -i:9099
lsof -i:5173

# 杀掉进程
kill -9 <PID>
```

---

## 🎊 测试通过标准

### 后端测试通过标准

- ✅ 所有API返回 200 状态码
- ✅ 返回数据格式正确
- ✅ Token验证正常
- ✅ 历史查询API正常工作

### 前端测试通过标准

- ✅ 登录功能正常
- ✅ 所有页面正常加载
- ✅ 数据请求正常
- ✅ Token自动携带
- ✅ 路由守卫正常
- ✅ 无Console错误

---

## 🚀 测试完成后的下一步

### 选项 1：投入使用

系统已完全可用，可以：
- 部署流程定义
- 启动实际流程
- 处理业务任务

### 选项 2：继续开发 MVP2

开始下一阶段功能：
- BPMN 流程设计器
- 流程定义管理
- 表单设计器

### 选项 3：优化完善

完善现有功能：
- 流程详情页面
- 任务详情页面
- 流程图可视化

---

## 📞 需要帮助？

如果测试中遇到问题：

1. **查看后端日志**：查看控制台输出
2. **查看浏览器Console**：F12 → Console
3. **查看Network请求**：F12 → Network
4. **查看文档**：参考各个测试指南文档

---

## 🎉 测试清单

完成以下所有项目即为测试通过：

### 后端测试
- [ ] 后端服务启动成功
- [ ] 自动化测试脚本全部通过
- [ ] 历史查询API返回200
- [ ] Token验证正常

### 前端测试
- [ ] 前端服务启动成功
- [ ] 登录功能正常
- [ ] 流程列表页面正常
- [ ] 待办任务页面正常
- [ ] 已办任务页面正常
- [ ] Network请求全部成功
- [ ] Console无错误

### 集成测试
- [ ] 前后端数据交互正常
- [ ] Token自动管理正常
- [ ] 路由守卫正常
- [ ] 错误处理正常

---

**祝测试顺利！** 🚀

如果所有测试通过，恭喜您！MVP1阶段已完美完成！

