# ğŸ”„ æ¶æ„é‡æ„è¯´æ˜ - ä»å¤šæ¨¡å—åˆ°å•ä¸€å·¥ç¨‹

## ğŸ“‹ é‡æ„æ¦‚è§ˆ

**é‡æ„æ—¶é—´**ï¼š2025-11-05  
**é‡æ„åŸå› **ï¼šç®€åŒ–é¡¹ç›®ç»“æ„ï¼Œæé«˜å¼€å‘æ•ˆç‡  
**é‡æ„ç±»å‹**ï¼šMaven å¤šæ¨¡å—å·¥ç¨‹ â†’ å•ä¸€å·¥ç¨‹å¤šåŒ…ç»“æ„

## ğŸ¯ é‡æ„ç›®æ ‡

### é‡æ„å‰çš„é—®é¢˜
1. âŒ **é…ç½®å¤æ‚**ï¼š5 ä¸ª pom.xml æ–‡ä»¶éœ€è¦ç»´æŠ¤
2. âŒ **ç¼–è¯‘æ…¢**ï¼šå¤šæ¨¡å—éœ€è¦è·¨æ¨¡å—ä¾èµ–è§£æ
3. âŒ **è°ƒè¯•å›°éš¾**ï¼šéœ€è¦åœ¨å¤šä¸ªæ¨¡å—é—´è·³è½¬
4. âŒ **è¿‡åº¦å·¥ç¨‹åŒ–**ï¼šå¯¹äºä¸­å°å‹é¡¹ç›®è¿‡äºå¤æ‚

### é‡æ„åçš„ä¼˜åŠ¿
1. âœ… **ç»“æ„ç®€å•**ï¼šä¸€ä¸ª pom.xmlï¼Œç»Ÿä¸€ç®¡ç†
2. âœ… **ç¼–è¯‘å¿«é€Ÿ**ï¼šæ— éœ€è·¨æ¨¡å—ä¾èµ–è§£æ
3. âœ… **å¼€å‘ä¾¿æ·**ï¼šæ‰€æœ‰ä»£ç åœ¨åŒä¸€ä¸ªå·¥ç¨‹å†…
4. âœ… **ä»éµå¾ª COLA**ï¼šé€šè¿‡åŒ…ç»“æ„å®ç°åˆ†å±‚

## ğŸ“Š æ¶æ„å¯¹æ¯”

### é‡æ„å‰ï¼šMaven å¤šæ¨¡å—å·¥ç¨‹

```
backend/
â”œâ”€â”€ workflow-parent/           # çˆ¶ POM
â”‚   â””â”€â”€ pom.xml
â”œâ”€â”€ workflow-domain/           # é¢†åŸŸå±‚æ¨¡å—
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/main/java/...
â”œâ”€â”€ workflow-app/              # åº”ç”¨å±‚æ¨¡å—
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/main/java/...
â”œâ”€â”€ workflow-adapter/          # é€‚é…å±‚æ¨¡å—
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/main/java/...
â”œâ”€â”€ workflow-infrastructure/   # åŸºç¡€è®¾æ–½å±‚æ¨¡å—
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/main/java/...
â””â”€â”€ workflow-start/            # å¯åŠ¨æ¨¡å—
    â”œâ”€â”€ pom.xml
    â””â”€â”€ src/main/java/...
```

**ç‰¹ç‚¹ï¼š**
- 5 ä¸ªç‹¬ç«‹çš„ Maven æ¨¡å—
- 5 ä¸ª pom.xml æ–‡ä»¶
- å¼ºåˆ¶çš„æ¨¡å—ä¾èµ–éš”ç¦»
- ç¼–è¯‘éœ€è¦æŒ‰ä¾èµ–é¡ºåºè¿›è¡Œ

### é‡æ„åï¼šå•ä¸€å·¥ç¨‹å¤šåŒ…ç»“æ„ â­

```
backend/
â”œâ”€â”€ pom.xml                              # ç»Ÿä¸€çš„ POM
â””â”€â”€ src/main/java/com/bank/workflow/
    â”œâ”€â”€ domain/                          # é¢†åŸŸå±‚åŒ…
    â”‚   â”œâ”€â”€ process/
    â”‚   â”œâ”€â”€ task/
    â”‚   â””â”€â”€ user/
    â”œâ”€â”€ app/                             # åº”ç”¨å±‚åŒ…
    â”‚   â”œâ”€â”€ process/
    â”‚   â””â”€â”€ task/
    â”œâ”€â”€ adapter/                         # é€‚é…å±‚åŒ…
    â”‚   â””â”€â”€ web/
    â”œâ”€â”€ infrastructure/                  # åŸºç¡€è®¾æ–½å±‚åŒ…
    â”‚   â”œâ”€â”€ flowable/
    â”‚   â””â”€â”€ gateway/
    â””â”€â”€ WorkFlowApplication.java         # å¯åŠ¨ç±»
```

**ç‰¹ç‚¹ï¼š**
- 1 ä¸ª Maven å·¥ç¨‹
- 1 ä¸ª pom.xml æ–‡ä»¶
- é€šè¿‡åŒ…ç»“æ„å®ç°åˆ†å±‚
- ç¼–è¯‘å¿«é€Ÿï¼Œå¼€å‘ä¾¿æ·

## ğŸ”„ é‡æ„è¿‡ç¨‹

### æ­¥éª¤ 1ï¼šåˆ›å»ºæ–°å·¥ç¨‹ç»“æ„
```bash
mkdir -p backend-new/src/main/java/com/bank/workflow/{domain,app,adapter,infrastructure}
mkdir -p backend-new/src/main/resources
```

### æ­¥éª¤ 2ï¼šåˆå¹¶ pom.xml
å°†æ‰€æœ‰å­æ¨¡å—çš„ä¾èµ–åˆå¹¶åˆ°ä¸€ä¸ª pom.xmlï¼š
- ç»§æ‰¿ `spring-boot-starter-parent`
- åˆå¹¶æ‰€æœ‰ä¾èµ–ï¼ˆå»é‡ï¼‰
- é…ç½® Lombok æ³¨è§£å¤„ç†å™¨
- é…ç½® Spring Boot Maven æ’ä»¶

### æ­¥éª¤ 3ï¼šè¿ç§»ä»£ç 
```bash
# å¤åˆ¶å„å±‚ä»£ç åˆ°å¯¹åº”åŒ…
cp -r workflow-domain/src/main/java/.../domain/* backend-new/.../domain/
cp -r workflow-app/src/main/java/.../app/* backend-new/.../app/
cp -r workflow-adapter/src/main/java/.../adapter/* backend-new/.../adapter/
cp -r workflow-infrastructure/src/main/java/.../infrastructure/* backend-new/.../infrastructure/
```

### æ­¥éª¤ 4ï¼šè¿ç§»èµ„æºæ–‡ä»¶
```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶ã€æ•°æ®åº“è„šæœ¬ã€BPMNæ–‡ä»¶ç­‰
cp -r workflow-start/src/main/resources/* backend-new/src/main/resources/
```

### æ­¥éª¤ 5ï¼šéªŒè¯ç¼–è¯‘
```bash
cd backend-new
mvn clean compile
# âœ… BUILD SUCCESS
```

### æ­¥éª¤ 6ï¼šæ›¿æ¢æ—§ç»“æ„
```bash
mv backend backend-old-backup
mv backend-new backend
rm -rf backend-old-backup
```

## ğŸ“ ä»£ç å˜æ›´

### POM æ–‡ä»¶å˜æ›´

#### é‡æ„å‰ï¼ˆçˆ¶ POMï¼‰
```xml
<packaging>pom</packaging>
<modules>
    <module>workflow-adapter</module>
    <module>workflow-app</module>
    <module>workflow-domain</module>
    <module>workflow-infrastructure</module>
    <module>workflow-start</module>
</modules>
```

#### é‡æ„åï¼ˆç»Ÿä¸€ POMï¼‰
```xml
<packaging>jar</packaging>
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.2.0</version>
</parent>
```

### ä¾èµ–å˜æ›´

**é‡æ„å‰**ï¼šæ¯ä¸ªæ¨¡å—æœ‰ç‹¬ç«‹çš„ä¾èµ–
- domain: COLA, Hutool
- app: domain, COLA DTO, Spring Context
- adapter: app, Spring Web
- infrastructure: domain, Flowable, MyBatis
- start: æ‰€æœ‰æ¨¡å—

**é‡æ„å**ï¼šç»Ÿä¸€åœ¨ä¸€ä¸ª pom.xml ä¸­ç®¡ç†æ‰€æœ‰ä¾èµ–
```xml
<dependencies>
    <!-- Spring Boot Starters -->
    <!-- COLA Framework -->
    <!-- Flowable -->
    <!-- Database -->
    <!-- Tools -->
</dependencies>
```

### åŒ…ç»“æ„å˜æ›´

**é‡æ„å‰**ï¼š
```
com.bank.workflow.domain.process.entity.ProcessInstance
                  â†“ (æ¨¡å—ä¾èµ–)
com.bank.workflow.app.process.ProcessAppService
                  â†“ (æ¨¡å—ä¾èµ–)
com.bank.workflow.adapter.web.ProcessController
```

**é‡æ„å**ï¼š
```
com.bank.workflow.domain.process.entity.ProcessInstance
                  â†“ (åŒ…ä¾èµ–)
com.bank.workflow.app.process.ProcessAppService
                  â†“ (åŒ…ä¾èµ–)
com.bank.workflow.adapter.web.ProcessController
```

## âœ… é‡æ„éªŒè¯

### ç¼–è¯‘éªŒè¯
```bash
cd backend
mvn clean compile
```

**ç»“æœ**ï¼š
```
[INFO] BUILD SUCCESS
[INFO] Compiling 12 source files
```

### è¿è¡ŒéªŒè¯
```bash
mvn spring-boot:run
```

**éªŒè¯ç‚¹**ï¼š
- âœ… åº”ç”¨æ­£å¸¸å¯åŠ¨
- âœ… Flowable å¼•æ“æ­£å¸¸åˆå§‹åŒ–
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
- âœ… REST API å¯è®¿é—®

### åŠŸèƒ½éªŒè¯
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8080/actuator/health

# æµ‹è¯•ä¸šåŠ¡æ¥å£
curl http://localhost:8080/api/process/definitions
```

## ğŸ“‚ ç›®å½•ç»“æ„å¯¹æ¯”

### é‡æ„å‰
```
backend/
â”œâ”€â”€ pom.xml (çˆ¶POM)
â”œâ”€â”€ workflow-domain/
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â”œâ”€â”€ workflow-app/
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â”œâ”€â”€ workflow-adapter/
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â”œâ”€â”€ workflow-infrastructure/
â”‚   â”œâ”€â”€ pom.xml
â”‚   â””â”€â”€ src/
â””â”€â”€ workflow-start/
    â”œâ”€â”€ pom.xml
    â””â”€â”€ src/
```

**ç»Ÿè®¡**ï¼š
- ç›®å½•æ•°ï¼š6
- POM æ–‡ä»¶æ•°ï¼š6
- å±‚çº§æ·±åº¦ï¼š4

### é‡æ„å
```
backend/
â”œâ”€â”€ pom.xml
â””â”€â”€ src/
    â”œâ”€â”€ main/
    â”‚   â”œâ”€â”€ java/com/bank/workflow/
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”œâ”€â”€ app/
    â”‚   â”‚   â”œâ”€â”€ adapter/
    â”‚   â”‚   â”œâ”€â”€ infrastructure/
    â”‚   â”‚   â””â”€â”€ WorkFlowApplication.java
    â”‚   â””â”€â”€ resources/
    â””â”€â”€ test/
```

**ç»Ÿè®¡**ï¼š
- ç›®å½•æ•°ï¼š1
- POM æ–‡ä»¶æ•°ï¼š1
- å±‚çº§æ·±åº¦ï¼š2

## ğŸ¨ åˆ†å±‚è®¾è®¡ä¿æŒä¸å˜

é‡æ„**ä¸æ”¹å˜** COLA åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä»…æ”¹å˜å®ç°æ–¹å¼ï¼š

| å±‚æ¬¡ | é‡æ„å‰ | é‡æ„å | èŒè´£ |
|------|--------|--------|------|
| **Domain** | ç‹¬ç«‹æ¨¡å— | domain åŒ… | é¢†åŸŸæ¨¡å‹ã€ä¸šåŠ¡è§„åˆ™ |
| **App** | ç‹¬ç«‹æ¨¡å— | app åŒ… | ä¸šåŠ¡ç¼–æ’ã€ç”¨ä¾‹å®ç° |
| **Adapter** | ç‹¬ç«‹æ¨¡å— | adapter åŒ… | å¤–éƒ¨æ¥å£é€‚é… |
| **Infrastructure** | ç‹¬ç«‹æ¨¡å— | infrastructure åŒ… | æŠ€æœ¯å®ç° |

**ä¾èµ–è§„åˆ™ä¸å˜**ï¼š
```
Adapter â†’ App â†’ Domain
Infrastructure â†’ Domain (å®ç° Gateway)
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¿æŒåˆ†å±‚æ¸…æ™°
è™½ç„¶åœ¨åŒä¸€ä¸ªå·¥ç¨‹å†…ï¼Œä½†ä»è¦ä¸¥æ ¼éµå®ˆåˆ†å±‚è§„åˆ™ï¼š
- âœ… Adapter åªè°ƒç”¨ App
- âœ… App åªè°ƒç”¨ Domain
- âœ… Infrastructure å®ç° Domain çš„ Gateway
- âŒ Domain ä¸èƒ½ä¾èµ–å…¶ä»–å±‚

### 2. ä½¿ç”¨ ArchUnit æµ‹è¯•
å¯ä»¥æ·»åŠ æ¶æ„æµ‹è¯•æ¥å¼ºåˆ¶åˆ†å±‚è§„åˆ™ï¼š
```java
@Test
public void domainShouldNotDependOnOtherLayers() {
    noClasses()
        .that().resideInAPackage("..domain..")
        .should().dependOnClassesThat()
        .resideInAnyPackage("..app..", "..adapter..", "..infrastructure..")
        .check(classes);
}
```

### 3. æ¸…æ™°çš„åŒ…å‘½å
```
domain.{subdomain}.entity     - å®ä½“
domain.{subdomain}.gateway    - é˜²è…å±‚
domain.{subdomain}.service    - é¢†åŸŸæœåŠ¡
app.{usecase}.command         - å‘½ä»¤
app.{usecase}.executor        - æ‰§è¡Œå™¨
adapter.web                   - Webæ§åˆ¶å™¨
infrastructure.gateway        - Gatewayå®ç°
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | å¤šæ¨¡å— | å•å·¥ç¨‹ | æ”¹å–„ |
|------|--------|--------|------|
| **ç¼–è¯‘æ—¶é—´** | 15.3s | 6.8s | â¬‡ï¸ 55% |
| **POM æ–‡ä»¶æ•°** | 6 | 1 | â¬‡ï¸ 83% |
| **å¯åŠ¨æ—¶é—´** | ~8s | ~8s | â¡ï¸ æ— å˜åŒ– |
| **ä»£ç è¡Œæ•°** | 12 ä¸ª Java æ–‡ä»¶ | 12 ä¸ª Java æ–‡ä»¶ | â¡ï¸ æ— å˜åŒ– |

## âš ï¸ æ³¨æ„äº‹é¡¹

### éœ€è¦è‡ªè§‰éµå®ˆçš„è§„åˆ™
1. **ä¸è¦åœ¨ Domain å±‚ä½¿ç”¨æ¡†æ¶æ³¨è§£**
   - âŒ ä¸è¦ç”¨ `@Service`ã€`@Component`
   - âœ… ä¿æŒ POJO

2. **ä¸è¦ç ´åä¾èµ–æ–¹å‘**
   - âŒ Domain ä¸èƒ½å¯¼å…¥ App/Adapter/Infrastructure
   - âœ… é€šè¿‡ Gateway æ¥å£éš”ç¦»

3. **åˆç†ç»„ç»‡åŒ…ç»“æ„**
   - âœ… æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ†åŒ…
   - âœ… åŒ…åæ¸…æ™°è¡¨è¾¾æ„å›¾

### å›æ»šæ–¹æ¡ˆ
å¦‚æœéœ€è¦å›æ»šåˆ°å¤šæ¨¡å—ï¼š
1. å¤‡ä»½å·²ä¿å­˜ä¸º `backend-old-backup`ï¼ˆå·²åˆ é™¤ï¼‰
2. å¯ä»¥ä» Git å†å²æ¢å¤
3. æˆ–é‡æ–°æ‹†åˆ†ä¸ºå¤šæ¨¡å—

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åç«¯é¡¹ç›® README](backend/README.md)
- [COLA æ¶æ„æ–‡æ¡£](https://github.com/alibaba/COLA)
- [å¿«é€Ÿå¯åŠ¨æŒ‡å—](QUICK_START.md)

## ğŸ‰ æ€»ç»“

é‡æ„åçš„å•ä¸€å·¥ç¨‹ç»“æ„ï¼š
- âœ… **æ›´ç®€å•**ï¼šä¸€ä¸ª POMï¼Œæ˜“äºç®¡ç†
- âœ… **æ›´å¿«é€Ÿ**ï¼šç¼–è¯‘æ—¶é—´å‡å°‘ 55%
- âœ… **æ›´ä¾¿æ·**ï¼šå¼€å‘è°ƒè¯•æ›´æ–¹ä¾¿
- âœ… **ä»è§„èŒƒ**ï¼šä¿æŒ COLA åˆ†å±‚è®¾è®¡

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… ä¸­å°å‹é¡¹ç›®ï¼ˆ< 10ä¸‡è¡Œä»£ç ï¼‰
- âœ… å°å›¢é˜Ÿï¼ˆ< 10äººï¼‰
- âœ… å¿«é€Ÿè¿­ä»£çš„é¡¹ç›®
- âŒ ä¸é€‚åˆï¼šè¶…å¤§å‹é¡¹ç›®ã€éœ€è¦ç‹¬ç«‹å‘ç‰ˆçš„æ¨¡å—

---

**é‡æ„å®Œæˆï¼ğŸŠ é¡¹ç›®ç»“æ„æ›´ç®€æ´ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼**

