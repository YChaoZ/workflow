# 🧪 前后端联调测试指南

## 📋 测试前准备

### 1. 启动后端服务

```bash
cd /Users/yanchao/IdeaProjects/workFolw/backend
mvn spring-boot:run
```

**确认后端启动成功**：
- 访问：http://localhost:9099/api/process/health
- 预期返回：`{"code":200,"message":"服务正常","timestamp":...}`

---

### 2. 启动前端服务

```bash
cd /Users/yanchao/IdeaProjects/workFolw/frontend
npm install   # 首次运行需要安装依赖
npm run dev
```

**访问前端**：http://localhost:5173

---

## 🔐 测试1：登录功能

### 步骤

1. **打开浏览器**
   - 访问：http://localhost:5173
   - 应自动跳转到登录页：http://localhost:5173/login

2. **输入测试账号**
   ```
   用户名：admin
   密码：admin123
   ```

3. **点击登录或按回车**

### 预期结果

✅ **成功**：
- 显示"登录成功"提示
- 自动跳转到首页（http://localhost:5173/home）
- 顶部显示用户名"系统管理员"

❌ **失败**：
- 检查后端是否启动
- 检查控制台错误信息
- 检查网络请求（F12 → Network）

---

## 📊 测试2：流程实例列表

### 步骤

1. **进入流程实例页面**
   - 点击侧边栏"流程管理" → "流程实例"
   - 或直接访问：http://localhost:5173/process/instance

2. **查看列表**
   - 页面应显示"流程实例列表"
   - 表格可能为空（因为还没有流程实例）

3. **测试搜索功能**
   - 输入搜索条件
   - 点击"查询"按钮
   - 点击"重置"按钮

4. **测试分页**
   - 切换每页显示数量
   - 切换页码

### 预期结果

✅ **成功**：
- 页面正常加载
- 显示"流程实例列表"
- 显示"总共 0 条"
- 搜索和分页功能正常

❌ **失败**：
- 检查控制台错误
- 检查网络请求
- 检查后端API `/api/process/instances`

---

## ✅ 测试3：待办任务列表

### 步骤

1. **进入待办任务页面**
   - 点击侧边栏"任务管理" → "待办任务"
   - 或直接访问：http://localhost:5173/task/todo

2. **查看列表**
   - 页面应显示"待办任务列表"
   - 右上角显示待办数量
   - 表格可能为空

3. **测试搜索功能**
   - 输入任务名称
   - 输入流程KEY
   - 点击"查询"
   - 点击"重置"

### 预期结果

✅ **成功**：
- 页面正常加载
- 显示待办任务数量（"0 个待办"）
- 搜索功能正常

---

## 📝 测试4：已办任务列表

### 步骤

1. **进入已办任务页面**
   - 点击侧边栏"任务管理" → "已办任务"
   - 或直接访问：http://localhost:5173/task/done

2. **查看列表**
   - 页面应显示"已办任务列表"
   - 右上角显示总数（"共 0 个"）

### 预期结果

✅ **成功**：
- 页面正常加载
- 显示正确的统计信息

---

## 🔄 测试5：登出功能

### 步骤

1. **点击右上角用户名**
   - 下拉菜单中选择"退出登录"
   - 或直接点击退出按钮

2. **确认登出**

### 预期结果

✅ **成功**：
- 显示"登出成功"提示（如果有）
- 自动跳转到登录页
- Token 被清除
- 再次访问其他页面会跳转到登录页

---

## 🎯 测试6：路由守卫

### 步骤

1. **清除浏览器 localStorage**
   - 打开浏览器控制台（F12）
   - Application → Local Storage → http://localhost:5173
   - 删除 `token` 项

2. **访问受保护的页面**
   - 访问：http://localhost:5173/process/instance
   - 或：http://localhost:5173/task/todo

### 预期结果

✅ **成功**：
- 自动跳转到登录页
- 未授权用户无法访问内部页面

---

## 🌐 测试7：网络请求（重要！）

### 步骤

1. **打开浏览器开发者工具**
   - 按 F12 或右键 → 检查
   - 切换到 "Network" 标签页

2. **登录并操作**
   - 登录
   - 查看流程列表
   - 查看任务列表

3. **检查网络请求**
   - 查看请求 URL
   - 查看请求方法（GET/POST）
   - 查看请求头（Authorization: Bearer xxx）
   - 查看响应状态（200、401、500等）
   - 查看响应数据

### 预期结果

✅ **登录请求**：
```
Request URL: http://localhost:5173/api/auth/login
Method: POST
Status: 200
Response: 
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "accessToken": "eyJhbGci...",
    "userInfo": { ... }
  }
}
```

✅ **查询请求**：
```
Request URL: http://localhost:5173/api/process/instances?pageNum=1&pageSize=10
Method: GET
Headers: Authorization: Bearer eyJhbGci...
Status: 200
Response:
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "list": [],
    "total": 0,
    ...
  }
}
```

---

## 🐛 常见问题排查

### 问题1：登录后显示 401 Unauthorized

**可能原因**：
- Token 没有正确保存
- 请求头没有携带 Token
- Token 格式错误

**排查方法**：
1. 检查 localStorage 中是否有 token
2. 检查网络请求头中是否有 `Authorization: Bearer xxx`
3. 检查 Token 是否以 "Bearer " 开头

**解决方法**：
- 检查 `request.ts` 中的请求拦截器
- 确保 Token 正确存储和读取

---

### 问题2：跨域错误 CORS

**错误信息**：
```
Access to XMLHttpRequest at 'http://localhost:9099/api/auth/login' 
from origin 'http://localhost:5173' has been blocked by CORS policy
```

**解决方法**：
1. 确认后端 CORS 配置正确
2. 检查 Vite 代理配置（`vite.config.ts`）
3. 使用代理方式访问：`/api/xxx` 而不是 `http://localhost:9099/api/xxx`

---

### 问题3：网络请求超时

**可能原因**：
- 后端服务未启动
- 端口号错误
- 防火墙阻止

**解决方法**：
1. 确认后端服务启动：`lsof -i:9099`
2. 检查 `vite.config.ts` 中的代理配置
3. 检查防火墙设置

---

### 问题4：页面白屏或组件不显示

**可能原因**：
- 前端代码错误
- 路由配置错误
- 组件导入错误

**排查方法**：
1. 查看浏览器控制台错误
2. 检查 Vue Devtools
3. 检查组件导入路径

**解决方法**：
- 修复代码错误
- 确认路由配置正确
- 确认组件导入路径正确

---

### 问题5：数据不显示或显示undefined

**可能原因**：
- API 返回数据结构不匹配
- 字段名称不一致
- 数据未正确赋值

**排查方法**：
1. 检查网络响应数据结构
2. 检查 TypeScript 接口定义
3. 检查数据赋值逻辑

---

## 📝 测试检查清单

### 基础功能测试

- [ ] 前端服务启动正常
- [ ] 后端服务启动正常
- [ ] 登录功能正常
- [ ] 登出功能正常
- [ ] 路由守卫正常
- [ ] Token 自动携带
- [ ] 401 自动跳转登录

### 页面功能测试

- [ ] 流程实例列表加载
- [ ] 流程实例搜索
- [ ] 流程实例分页
- [ ] 待办任务列表加载
- [ ] 待办任务搜索
- [ ] 待办任务分页
- [ ] 已办任务列表加载

### 交互功能测试

- [ ] Loading 状态显示
- [ ] 成功提示显示
- [ ] 错误提示显示
- [ ] 表单验证提示
- [ ] 确认对话框显示
- [ ] 日期格式化正常
- [ ] 状态标签显示

### 网络请求测试

- [ ] 登录请求成功
- [ ] 查询请求成功
- [ ] 请求头携带 Token
- [ ] 响应数据格式正确
- [ ] 错误处理正常

---

## 🎯 下一步测试（实际业务流程）

### 测试场景1：完整流程测试

**目标**：测试从登录到任务办理的完整流程

**前置条件**：需要部署流程定义和创建流程实例

**步骤**：
1. 登录系统
2. 启动流程（需要流程定义）
3. 查看待办任务
4. 办理任务
5. 查看已办任务

**注意**：目前数据库中还没有流程实例和任务数据，所以列表都是空的。这是正常的！

---

### 测试场景2：流程管理测试

**需要**：
1. 部署流程定义文件
2. 启动流程实例
3. 测试挂起/激活/删除操作

---

## 💡 测试提示

1. **使用浏览器开发者工具**
   - Network 标签：查看网络请求
   - Console 标签：查看错误日志
   - Application 标签：查看 localStorage

2. **使用 Vue Devtools**
   - 查看组件状态
   - 查看 Pinia Store 状态
   - 查看路由信息

3. **多测试不同场景**
   - 正常流程
   - 异常情况（如网络错误）
   - 边界情况（如空数据）

4. **记录问题**
   - 记录错误信息
   - 记录复现步骤
   - 截图保存

---

## 📊 测试报告模板

```markdown
### 测试报告

**测试时间**：2025-11-05
**测试人员**：[Your Name]
**测试环境**：
- 前端：http://localhost:5173
- 后端：http://localhost:9099

**测试结果**：

| 功能模块 | 测试项 | 结果 | 备注 |
|---------|--------|------|------|
| 登录 | 正常登录 | ✅ | - |
| 登录 | 错误密码 | ✅ | 提示正确 |
| 流程列表 | 页面加载 | ✅ | - |
| 流程列表 | 搜索功能 | ✅ | - |
| 任务列表 | 页面加载 | ✅ | - |
| ... | ... | ... | ... |

**发现的问题**：
1. [问题描述]
2. [问题描述]

**建议**：
1. [改进建议]
2. [改进建议]
```

---

## 🎉 测试成功标准

### 基本功能测试通过

- ✅ 所有页面正常加载
- ✅ 所有API请求成功
- ✅ 数据正常显示
- ✅ 交互功能正常
- ✅ 错误处理正常

### 用户体验良好

- ✅ Loading 状态正常
- ✅ 提示信息友好
- ✅ 操作流畅
- ✅ 界面美观

---

**准备好了吗？开始测试吧！** 🚀

如有问题，请参考上述排查方法，或联系开发人员！

