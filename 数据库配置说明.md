# âœ… æ•°æ®åº“é…ç½®å·²å®Œæˆ

## å½“å‰é…ç½®ä¿¡æ¯

### æ•°æ®åº“è¿æ¥ä¿¡æ¯
- **æ•°æ®åº“åç§°**ï¼š`workflow`
- **ä¸»æœºåœ°å€**ï¼š`localhost:3306`
- **ç”¨æˆ·å**ï¼š`root`
- **å¯†ç **ï¼š`1qaz2wsx`
- **å­—ç¬¦é›†**ï¼š`utf8mb4`

### é…ç½®æ–‡ä»¶å·²æ›´æ–° âœ…

#### 1. application.ymlï¼ˆä¸»é…ç½®ï¼‰
```yaml
spring:
  datasource:
    druid:
      url: jdbc:mysql://localhost:3306/workflow?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
      username: root
      password: 1qaz2wsx
```

#### 2. application-dev.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```yaml
spring:
  datasource:
    druid:
      url: jdbc:mysql://localhost:3306/workflow?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
      username: root
      password: 1qaz2wsx
```

#### 3. application-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```yaml
# ç”Ÿäº§ç¯å¢ƒéœ€è¦å•ç‹¬é…ç½®ï¼Œä½¿ç”¨ä¸“ç”¨è´¦å·
spring:
  datasource:
    druid:
      url: jdbc:mysql://your-prod-host:3306/workflow
      username: workflow_user
      password: change-me-in-production
```

---

## æ•°æ®åº“åˆå§‹åŒ–

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨åˆå§‹åŒ–ï¼ˆæ¨èï¼‰âœ…

**Flyway ä¼šåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“è„šæœ¬**

1. **ç¡®è®¤æ•°æ®åº“å·²åˆ›å»º**
   ```sql
   -- å·²åˆ›å»º âœ…
   CREATE DATABASE workflow CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

2. **å¯åŠ¨åº”ç”¨**
   ```bash
   cd backend
   mvn spring-boot:run
   ```

3. **Flyway è‡ªåŠ¨æ‰§è¡Œ**
   - âœ… æ‰§è¡Œ `V1__init_tables.sql` - åˆ›å»º 15 å¼ ä¸šåŠ¡è¡¨
   - âœ… æ‰§è¡Œ `V2__init_data.sql` - åˆå§‹åŒ–åŸºç¡€æ•°æ®
   - âœ… Flowable è‡ªåŠ¨åˆ›å»ºçº¦ 70 å¼ å¼•æ“è¡¨

4. **éªŒè¯åˆå§‹åŒ–**
   ```sql
   -- æŸ¥çœ‹ Flyway è¿ç§»å†å²
   SELECT * FROM flyway_schema_history;
   
   -- æŸ¥çœ‹ä¸šåŠ¡è¡¨ï¼ˆåº”è¯¥æœ‰ 15 å¼ ï¼‰
   SHOW TABLES LIKE 'wf_%';
   SHOW TABLES LIKE 'sys_%';
   
   -- æŸ¥çœ‹ Flowable è¡¨ï¼ˆåº”è¯¥æœ‰çº¦ 70 å¼ ï¼‰
   SHOW TABLES LIKE 'ACT_%';
   SHOW TABLES LIKE 'FLW_%';
   ```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨åˆå§‹åŒ–ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬ï¼š

```bash
# 1. è¿›å…¥è„šæœ¬ç›®å½•
cd backend/src/main/resources/db/migration

# 2. æ‰§è¡Œè¡¨ç»“æ„è„šæœ¬
mysql -u root -p1qaz2wsx workflow < V1__init_tables.sql

# 3. æ‰§è¡Œåˆå§‹æ•°æ®è„šæœ¬
mysql -u root -p1qaz2wsx workflow < V2__init_data.sql
```

**æ³¨æ„**ï¼šå¦‚æœæ‰‹åŠ¨æ‰§è¡Œäº†è„šæœ¬ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ç¦ç”¨ Flywayï¼š
```yaml
spring:
  flyway:
    enabled: false
```

---

## æ•°æ®åº“è¡¨æ¸…å•

### ä¸šåŠ¡è¡¨ï¼ˆ15 å¼ ï¼‰

#### æµç¨‹ç›¸å…³ï¼ˆ4 å¼ ï¼‰
1. `wf_process_category` - æµç¨‹åˆ†ç±»è¡¨
2. `wf_process_definition_ext` - æµç¨‹å®šä¹‰æ‰©å±•è¡¨
3. `wf_process_instance_ext` - æµç¨‹å®ä¾‹æ‰©å±•è¡¨
4. `wf_task_ext` - ä»»åŠ¡æ‰©å±•è¡¨

#### è¡¨å•ç›¸å…³ï¼ˆ3 å¼ ï¼‰
5. `wf_form_definition` - è¡¨å•å®šä¹‰è¡¨
6. `wf_form_field` - è¡¨å•å­—æ®µè¡¨
7. `wf_form_instance` - è¡¨å•å®ä¾‹è¡¨

#### ç»„ç»‡æƒé™ï¼ˆ7 å¼ ï¼‰
8. `sys_org` - ç»„ç»‡æ¶æ„è¡¨
9. `sys_user` - ç”¨æˆ·è¡¨
10. `sys_role` - è§’è‰²è¡¨
11. `sys_user_role` - ç”¨æˆ·è§’è‰²å…³è”è¡¨
12. `sys_permission` - æƒé™è¡¨
13. `sys_role_permission` - è§’è‰²æƒé™å…³è”è¡¨

#### ç›‘æ§ç»Ÿè®¡ï¼ˆ2 å¼ ï¼‰
14. `wf_process_monitor_log` - æµç¨‹ç›‘æ§æ—¥å¿—è¡¨
15. `wf_process_performance_stat` - æµç¨‹æ€§èƒ½ç»Ÿè®¡è¡¨

### Flowable å¼•æ“è¡¨ï¼ˆçº¦ 70 å¼ ï¼‰

Flowable ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹ç±»å‹çš„è¡¨ï¼š
- `ACT_RE_*` - æµç¨‹å®šä¹‰å’Œèµ„æºï¼ˆRepositoryï¼‰
- `ACT_RU_*` - è¿è¡Œæ—¶æ•°æ®ï¼ˆRuntimeï¼‰
- `ACT_HI_*` - å†å²æ•°æ®ï¼ˆHistoryï¼‰
- `ACT_ID_*` - èº«ä»½æ•°æ®ï¼ˆIdentityï¼‰
- `ACT_GE_*` - é€šç”¨æ•°æ®ï¼ˆGeneralï¼‰
- `FLW_*` - Flowable ç›¸å…³è¡¨

---

## åˆå§‹æ•°æ®

### é»˜è®¤ç”¨æˆ·
```
ç”¨æˆ·åï¼šadmin
å¯†ç ï¼šadmin123ï¼ˆMD5 åŠ å¯†ï¼‰
è§’è‰²ï¼šç³»ç»Ÿç®¡ç†å‘˜
```

### é»˜è®¤è§’è‰²ï¼ˆ3 ä¸ªï¼‰
1. ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆADMINï¼‰
2. æµç¨‹ç®¡ç†å‘˜ï¼ˆPROCESS_ADMINï¼‰
3. æ™®é€šç”¨æˆ·ï¼ˆUSERï¼‰

### æµç¨‹åˆ†ç±»ï¼ˆ6 ä¸ªï¼‰
1. åŠå…¬æµç¨‹
2. è´¢åŠ¡æµç¨‹
3. äººäº‹æµç¨‹
4. é‡‡è´­æµç¨‹
5. é”€å”®æµç¨‹
6. å…¶ä»–æµç¨‹

---

## å¿«é€ŸéªŒè¯

### 1. å¯åŠ¨åº”ç”¨
```bash
cd /Users/yanchao/IdeaProjects/workFolw/backend
mvn spring-boot:run
```

### 2. è§‚å¯Ÿå¯åŠ¨æ—¥å¿—

**æˆåŠŸçš„æ ‡å¿—**ï¼š
```
âœ“ Flyway - Successfully validated 2 migrations
âœ“ Flyway - Migrating schema `workflow` to version "1 - init tables"
âœ“ Flyway - Migrating schema `workflow` to version "2 - init data"
âœ“ Flyway - Successfully applied 2 migrations
âœ“ Flowable ProcessEngine initialized
âœ“ Started WorkFlowApplication in 5.8 seconds
```

### 3. éªŒè¯æ•°æ®åº“

```sql
-- è¿æ¥æ•°æ®åº“
mysql -u root -p1qaz2wsx workflow

-- æŸ¥çœ‹æ‰€æœ‰è¡¨
SHOW TABLES;

-- åº”è¯¥çœ‹åˆ°çº¦ 85 å¼ è¡¨ï¼ˆ15 å¼ ä¸šåŠ¡è¡¨ + 70 å¼  Flowable è¡¨ï¼‰
SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'workflow';

-- éªŒè¯åˆå§‹æ•°æ®
SELECT * FROM sys_user;          -- admin ç”¨æˆ·
SELECT * FROM sys_role;          -- 3 ä¸ªè§’è‰²
SELECT * FROM wf_process_category;  -- 6 ä¸ªåˆ†ç±»

-- æŸ¥çœ‹ Flyway è¿ç§»å†å²
SELECT * FROM flyway_schema_history ORDER BY installed_rank;
```

---

## è¿æ¥æ± é…ç½®ï¼ˆDruidï¼‰

### å½“å‰é…ç½®
```yaml
druid:
  initial-size: 5           # åˆå§‹è¿æ¥æ•°
  min-idle: 10              # æœ€å°ç©ºé—²è¿æ¥æ•°
  max-active: 20            # æœ€å¤§æ´»åŠ¨è¿æ¥æ•°
  max-wait: 60000           # è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  validation-query: SELECT 1 # è¿æ¥æœ‰æ•ˆæ€§æ£€æŸ¥
```

### Druid ç›‘æ§é¡µé¢
å¯åŠ¨åº”ç”¨åè®¿é—®ï¼šhttp://localhost:8080/druid/

**ç™»å½•ä¿¡æ¯**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin`

**å¯ä»¥ç›‘æ§**ï¼š
- SQL æ‰§è¡Œç»Ÿè®¡
- è¿æ¥æ± ä½¿ç”¨æƒ…å†µ
- æ…¢ SQL åˆ†æ
- æ•°æ®åº“æ€§èƒ½

---

## å¸¸è§é—®é¢˜

### Q1: è¿æ¥æ•°æ®åº“å¤±è´¥

**é”™è¯¯**ï¼š`Access denied for user 'root'@'localhost'`

**è§£å†³**ï¼š
```sql
-- æ£€æŸ¥ç”¨æˆ·æƒé™
mysql -u root -p

-- åˆ›å»ºç”¨æˆ·å¹¶æˆæƒï¼ˆå¦‚æœéœ€è¦ï¼‰
CREATE USER 'root'@'localhost' IDENTIFIED BY '1qaz2wsx';
GRANT ALL PRIVILEGES ON workflow.* TO 'root'@'localhost';
FLUSH PRIVILEGES;
```

### Q2: æ•°æ®åº“ä¸å­˜åœ¨

**é”™è¯¯**ï¼š`Unknown database 'workflow'`

**è§£å†³**ï¼š
```sql
CREATE DATABASE workflow CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### Q3: Flyway è¿ç§»å¤±è´¥

**é”™è¯¯**ï¼š`FlywayException: Validate failed`

**è§£å†³**ï¼š
```sql
-- æ¸…ç©ºæ•°æ®åº“é‡æ–°åˆå§‹åŒ–
DROP DATABASE workflow;
CREATE DATABASE workflow CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- æˆ–è€…æ¸…ç©º Flyway å†å²
DELETE FROM flyway_schema_history;
```

### Q4: ä¸­æ–‡ä¹±ç 

**ç¡®è®¤é…ç½®**ï¼š
```yaml
# æ•°æ®åº“è¿æ¥
url: jdbc:mysql://localhost:3306/workflow?useUnicode=true&characterEncoding=utf8

# æ•°æ®åº“å­—ç¬¦é›†
CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci
```

---

## å®‰å…¨å»ºè®®

### âš ï¸ å¼€å‘ç¯å¢ƒ
- âœ… ä½¿ç”¨ root è´¦å·ï¼ˆæ–¹ä¾¿å¼€å‘ï¼‰
- âœ… å¯†ç å·²é…ç½®

### ğŸ”’ ç”Ÿäº§ç¯å¢ƒï¼ˆé‡è¦ï¼ï¼‰
```sql
-- 1. åˆ›å»ºä¸“ç”¨æ•°æ®åº“ç”¨æˆ·
CREATE USER 'workflow_user'@'%' IDENTIFIED BY 'strong_password_here';

-- 2. æˆäºˆå¿…è¦æƒé™
GRANT SELECT, INSERT, UPDATE, DELETE ON workflow.* TO 'workflow_user'@'%';
FLUSH PRIVILEGES;

-- 3. æ›´æ–° application-prod.yml
spring:
  datasource:
    druid:
      username: workflow_user
      password: strong_password_here  # ä½¿ç”¨ç¯å¢ƒå˜é‡æ›´å®‰å…¨
```

### å¯†ç ç®¡ç†
```yaml
# ä¸æ¨èï¼šæ˜æ–‡å¯†ç 
password: 1qaz2wsx

# æ¨èï¼šä½¿ç”¨ç¯å¢ƒå˜é‡
password: ${DB_PASSWORD}

# æˆ–ä½¿ç”¨ Spring Cloud Config Server
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç´¢å¼•ä¼˜åŒ–
```sql
-- ä¸šåŠ¡è¡¨å·²åŒ…å«å¿…è¦çš„ç´¢å¼•
-- Flowable è¡¨ä¼šè‡ªåŠ¨åˆ›å»ºç´¢å¼•

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SHOW INDEX FROM wf_process_instance_ext;
```

### 2. è¿æ¥æ± è°ƒä¼˜
æ ¹æ®å®é™…å¹¶å‘é‡è°ƒæ•´ï¼š
```yaml
druid:
  initial-size: 10       # å¢åŠ åˆå§‹è¿æ¥
  min-idle: 20           # å¢åŠ æœ€å°ç©ºé—²
  max-active: 50         # å¢åŠ æœ€å¤§è¿æ¥
```

### 3. æ…¢æŸ¥è¯¢ç›‘æ§
```yaml
druid:
  connection-properties: druid.stat.slowSqlMillis=3000  # 3ç§’ä»¥ä¸Šä¸ºæ…¢SQL
```

è®¿é—® Druid ç›‘æ§æŸ¥çœ‹æ…¢ SQLã€‚

---

## é…ç½®æ–‡ä»¶ä½ç½®

```
backend/src/main/resources/
â”œâ”€â”€ application.yml              # ä¸»é…ç½®ï¼ˆå·²æ›´æ–° âœ…ï¼‰
â”œâ”€â”€ application-dev.yml          # å¼€å‘ç¯å¢ƒï¼ˆå·²æ›´æ–° âœ…ï¼‰
â”œâ”€â”€ application-prod.yml         # ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨¡æ¿ï¼‰
â””â”€â”€ db/migration/                # æ•°æ®åº“è„šæœ¬
    â”œâ”€â”€ V1__init_tables.sql      # è¡¨ç»“æ„
    â”œâ”€â”€ V2__init_data.sql        # åˆå§‹æ•°æ®
    â””â”€â”€ README.md                # è„šæœ¬è¯´æ˜
```

---

## æ€»ç»“

### âœ… å·²å®Œæˆé…ç½®
1. âœ… æ•°æ®åº“åç§°ï¼š`workflow`
2. âœ… ç”¨æˆ·åï¼š`root`
3. âœ… å¯†ç ï¼š`1qaz2wsx`
4. âœ… application.yml å·²æ›´æ–°
5. âœ… application-dev.yml å·²æ›´æ–°
6. âœ… Flyway è‡ªåŠ¨è¿ç§»å·²é…ç½®
7. âœ… Druid è¿æ¥æ± å·²é…ç½®

### ğŸš€ ä¸‹ä¸€æ­¥
1. å¯åŠ¨åº”ç”¨ï¼š`cd backend && mvn spring-boot:run`
2. è§‚å¯Ÿæ—¥å¿—ç¡®è®¤ Flyway æ‰§è¡ŒæˆåŠŸ
3. éªŒè¯æ•°æ®åº“è¡¨æ˜¯å¦åˆ›å»ºï¼ˆçº¦ 85 å¼ è¡¨ï¼‰
4. è®¿é—® Druid ç›‘æ§ï¼šhttp://localhost:8080/druid/
5. å¼€å§‹å¼€å‘åŠŸèƒ½

---

**ğŸ‰ æ•°æ®åº“é…ç½®å®Œæˆï¼å¯ä»¥æ­£å¸¸å¯åŠ¨é¡¹ç›®äº†ï¼**

