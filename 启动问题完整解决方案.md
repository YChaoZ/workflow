# å¯åŠ¨é—®é¢˜å®Œæ•´è§£å†³æ–¹æ¡ˆ âœ…

## ğŸ” é—®é¢˜æ ¹æœ¬åŸå› 

**MyBatis-Plusä¸Spring Boot 3.x + Java 23çš„å…¼å®¹æ€§é—®é¢˜**

é”™è¯¯ä¿¡æ¯ï¼š
```
Invalid value type for attribute 'factoryBeanObjectType': java.lang.String
```

## âœ… æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

### 1. **ä½¿ç”¨Java 17ï¼ˆè€ŒéJava 23ï¼‰**

**åŸå› ï¼š** Spring Boot 3.2.0å®˜æ–¹åªæ”¯æŒJava 17å’Œ21ï¼ŒJava 23å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚

**Java 17è·¯å¾„ï¼š**
```bash
/opt/homebrew/Cellar/openjdk@17/17.0.15/libexec/openjdk.jdk/Contents/Home
```

### 2. **å‡çº§MyBatis-Plusåˆ°3.5.9**

æ›´æ–° `pom.xml`ï¼š
```xml
<mybatis-plus.version>3.5.9</mybatis-plus.version>
<druid.version>1.2.23</druid.version>
```

### 3. **ä¿®å¤ProcessDiagramGeneratoræ³¨å…¥é—®é¢˜**

ä¿®æ”¹ `ProcessEngineGatewayImpl.java`ï¼š
- **ä¹‹å‰ï¼š** é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ `ProcessDiagramGenerator`
- **ä¹‹åï¼š** æ³¨å…¥ `ProcessEngineConfiguration`ï¼Œç„¶ååŠ¨æ€è·å–ï¼š
  ```java
  ProcessDiagramGenerator processDiagramGenerator = 
      processEngineConfiguration.getProcessDiagramGenerator();
  ```

### 4. **ä¸´æ—¶ç¦ç”¨MVP2åŠŸèƒ½æ¨¡å—**

ç”±äºMVP2åŠŸèƒ½ï¼ˆæµç¨‹åˆ†ç±»ã€ä»»åŠ¡æ„è§ã€ä»»åŠ¡é™„ä»¶ï¼‰è¿˜æœªå®Œå…¨å¼€å‘å®Œæˆï¼Œä¸´æ—¶å°†ç›¸å…³æ–‡ä»¶é‡å‘½åä¸º `.bak`ï¼š

- `ProcessCategoryMapper.java.bak`
- `TaskCommentMapper.java.bak`
- `TaskAttachmentMapper.java.bak`
- `ProcessCategoryGatewayImpl.java.bak`
- `TaskCommentGatewayImpl.java.bak`
- `TaskAttachmentGatewayImpl.java.bak`
- ä»¥åŠç›¸å…³çš„AppServiceå’ŒControlleræ–‡ä»¶

**æ³¨æ„ï¼š** è¿™äº›æ–‡ä»¶åœ¨å®ŒæˆMVP2å¼€å‘æ—¶éœ€è¦æ¢å¤ï¼ˆå»æ‰ `.bak` åç¼€ï¼‰ã€‚

## ğŸš€ å¿«é€Ÿå¯åŠ¨æ–¹å¼

### æ–¹å¼1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
cd /Users/yanchao/IdeaProjects/workFolw/backend
./å¯åŠ¨è„šæœ¬.sh
```

### æ–¹å¼2ï¼šæ‰‹åŠ¨å¯åŠ¨
```bash
# è®¾ç½®Java 17
export JAVA_HOME="/opt/homebrew/Cellar/openjdk@17/17.0.15/libexec/openjdk.jdk/Contents/Home"

# ç¼–è¯‘
cd /Users/yanchao/IdeaProjects/workFolw/backend
mvn clean package -DskipTests

# è¿è¡Œ
$JAVA_HOME/bin/java -jar target/workflow-system-1.0.0-SNAPSHOT.jar --spring.profiles.active=dev
```

### æ–¹å¼3ï¼šåœ¨IDEAä¸­å¯åŠ¨
1. **é…ç½®Project SDKä¸ºJava 17**
   - `File` â†’ `Project Structure` â†’ `Project` â†’ `SDK` â†’ é€‰æ‹©Java 17

2. **æ¸…ç†IDEAç¼“å­˜**
   - `File` â†’ `Invalidate Caches...` â†’ `Invalidate and Restart`

3. **è¿è¡ŒApplication**
   - å³é”® `WorkFlowApplication` â†’ `Run`

## âœ… éªŒè¯å¯åŠ¨æˆåŠŸ

å¯åŠ¨æˆåŠŸåï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

```
============================================
å·¥ä½œæµç³»ç»Ÿå¯åŠ¨æˆåŠŸï¼
Workflow System Started Successfully!
============================================
è®¿é—®åœ°å€: http://localhost:9099
æ¥å£æ–‡æ¡£: http://localhost:9099/doc.html
Druidç›‘æ§: http://localhost:9099/druid/
============================================
```

**æµ‹è¯•åç«¯APIï¼š**
```bash
# æµ‹è¯•ç™»å½•
curl -X POST http://localhost:9099/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'

# æµ‹è¯•æµç¨‹æŸ¥è¯¢
curl http://localhost:9099/api/process/instances?page=1&size=10
```

## ğŸ“‹ å½“å‰å¯ç”¨åŠŸèƒ½

### âœ… MVP1åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰
1. **ç”¨æˆ·è®¤è¯æˆæƒ**
   - ç™»å½• (`POST /api/auth/login`)
   - JWTä»¤ç‰ŒéªŒè¯
   - æƒé™æ§åˆ¶

2. **æµç¨‹ç®¡ç†**
   - å¯åŠ¨æµç¨‹ (`POST /api/process/start`)
   - æŸ¥è¯¢æµç¨‹å®ä¾‹åˆ—è¡¨ (`GET /api/process/instances`)
   - æŸ¥è¯¢æµç¨‹å®ä¾‹è¯¦æƒ… (`GET /api/process/instances/{id}`)
   - æŒ‚èµ·/æ¿€æ´»æµç¨‹ (`POST /api/process/instances/{id}/suspend|activate`)
   - åˆ é™¤æµç¨‹ (`DELETE /api/process/instances/{id}`)

3. **ä»»åŠ¡ç®¡ç†**
   - æŸ¥è¯¢å¾…åŠä»»åŠ¡ (`GET /api/task/todo`)
   - æŸ¥è¯¢å·²åŠä»»åŠ¡ (`GET /api/task/done`)
   - æŸ¥è¯¢ä»»åŠ¡è¯¦æƒ… (`GET /api/task/{id}`)
   - å®Œæˆä»»åŠ¡ (`POST /api/task/{id}/complete`)
   - ç­¾æ”¶ä»»åŠ¡ (`POST /api/task/{id}/claim`)
   - å§”æ´¾ä»»åŠ¡ (`POST /api/task/{id}/delegate`)
   - è½¬åŠä»»åŠ¡ (`POST /api/task/{id}/assign`)

4. **å†å²æŸ¥è¯¢**
   - æŸ¥è¯¢å†å²æµç¨‹å®ä¾‹ (`GET /api/process/history/instances`)
   - æŸ¥è¯¢å†å²æ´»åŠ¨å®ä¾‹ (`GET /api/process/history/activities`)

5. **æµç¨‹å›¾ç”Ÿæˆ**
   - ç”Ÿæˆæµç¨‹å®šä¹‰å›¾ (`GET /api/process/definitions/{id}/diagram`)
   - ç”Ÿæˆæµç¨‹å®ä¾‹å›¾ï¼ˆé«˜äº®å½“å‰èŠ‚ç‚¹ï¼‰(`GET /api/process/instances/{id}/diagram`)

### ğŸš§ MVP2åŠŸèƒ½ï¼ˆå¾…æ¢å¤ï¼‰
- æµç¨‹å®šä¹‰ç®¡ç†ï¼ˆéƒ¨ç½²ã€åˆ é™¤ã€å¯ç”¨/ç¦ç”¨ï¼‰
- æµç¨‹åˆ†ç±»ç®¡ç†
- æµç¨‹ç‰ˆæœ¬ç®¡ç†
- ä»»åŠ¡æ„è§ç®¡ç†
- ä»»åŠ¡é™„ä»¶ç®¡ç†
- ä»»åŠ¡é«˜çº§æ“ä½œï¼ˆè½¬åŠã€åŠ ç­¾ã€é€€å›ï¼‰

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. Javaç‰ˆæœ¬
- âœ… **å¿…é¡»ä½¿ç”¨Java 17æˆ–21**
- âŒ **ä¸è¦ä½¿ç”¨Java 23**ï¼ˆä¼šå¯¼è‡´MyBatis-Pluså…¼å®¹æ€§é—®é¢˜ï¼‰

### 2. IDEAé…ç½®
- Project SDKï¼šJava 17
- Language Levelï¼šSDK default (17)
- Maven JVMï¼šä¸Project SDKä¸€è‡´

### 3. MVP2åŠŸèƒ½æ¢å¤
å½“éœ€è¦æ¢å¤MVP2åŠŸèƒ½æ—¶ï¼š
```bash
cd /Users/yanchao/IdeaProjects/workFolw/backend/src/main/java/com/bank/workflow
find . -name "*.java.bak" | while read file; do
  mv "$file" "${file%.bak}"
done
```

### 4. æ•°æ®åº“é…ç½®
ç¡®ä¿MySQLé…ç½®æ­£ç¡®ï¼š
```yaml
# application-dev.yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/workflow
    username: root
    password: 1qaz2wsx
```

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. âœ… åç«¯å·²æˆåŠŸå¯åŠ¨ï¼ˆMVP1åŠŸèƒ½å¯ç”¨ï¼‰
2. ğŸ¨ **å‰ç«¯å¼€å‘**ï¼šé›†æˆbpmn-jsæµç¨‹è®¾è®¡å™¨
3. ğŸ”— **å‰åç«¯è”è°ƒ**ï¼šæµ‹è¯•å®Œæ•´å·¥ä½œæµ
4. ğŸ“¦ **æ¢å¤MVP2åŠŸèƒ½**ï¼šæµç¨‹å®šä¹‰ç®¡ç†ã€åˆ†ç±»ã€æ„è§ã€é™„ä»¶ç­‰
5. ğŸš€ **å®Œæ•´æµ‹è¯•**ï¼šE2Eæµ‹è¯•

---

**åˆ›å»ºæ—¶é—´ï¼š** 2025-11-05 20:05  
**çŠ¶æ€ï¼š** âœ… å·²è§£å†³ï¼Œç³»ç»Ÿæ­£å¸¸è¿è¡Œ  
**Javaç‰ˆæœ¬ï¼š** 17.0.15  
**Spring Bootç‰ˆæœ¬ï¼š** 3.2.0  
**MyBatis-Plusç‰ˆæœ¬ï¼š** 3.5.9  
**ç«¯å£ï¼š** 9099

