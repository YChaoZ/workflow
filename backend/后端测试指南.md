# ğŸ§ª åç«¯APIæµ‹è¯•æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

1. **èµ‹äºˆæ‰§è¡Œæƒé™**
```bash
cd /Users/yanchao/IdeaProjects/workFolw
chmod +x test-backend-api.sh
```

2. **è¿è¡Œæµ‹è¯•**
```bash
./test-backend-api.sh
```

æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æŸ¥æœåŠ¡çŠ¶æ€
- âœ… æµ‹è¯•æ‰€æœ‰APIæ¥å£
- âœ… ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
- âœ… æ˜¾ç¤ºé€šè¿‡/å¤±è´¥/è·³è¿‡çš„æµ‹è¯•

---

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨æµ‹è¯•ï¼ˆè¯¦ç»†æ­¥éª¤ï¼‰

#### å‡†å¤‡å·¥ä½œ

ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ï¼š
```bash
cd backend
mvn spring-boot:run
```

æœåŠ¡åœ°å€ï¼š`http://localhost:9099`

---

## ğŸ“‹ æµ‹è¯•ç”¨ä¾‹

### 1. å¥åº·æ£€æŸ¥

```bash
curl http://localhost:9099/api/process/health
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æœåŠ¡æ­£å¸¸",
  "timestamp": 1762332057338
}
```

---

### 2. ç”¨æˆ·ç™»å½•

```bash
curl -X POST http://localhost:9099/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiJ9...",
    "tokenType": "Bearer",
    "expiresIn": 86400,
    "userInfo": {
      "userId": 1,
      "username": "admin",
      "realName": "ç³»ç»Ÿç®¡ç†å‘˜",
      "deptId": 1,
      "position": "ç³»ç»Ÿç®¡ç†å‘˜"
    }
  }
}
```

**âš ï¸ é‡è¦ï¼šä¿å­˜è¿”å›çš„ `accessToken`ï¼Œåç»­è¯·æ±‚éœ€è¦ä½¿ç”¨ï¼**

---

### 3. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

```bash
curl -X GET http://localhost:9099/api/auth/current \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "username": "admin"
  }
}
```

---

### 4. å¯åŠ¨æµç¨‹å®ä¾‹

```bash
curl -X POST http://localhost:9099/api/process/start \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "processKey": "simple-process",
    "businessKey": "TEST001",
    "startUser": "admin",
    "title": "æµ‹è¯•æµç¨‹",
    "variables": {
      "applicant": "admin",
      "reason": "æµ‹è¯•å¯åŠ¨æµç¨‹",
      "amount": 1000
    }
  }'
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æµç¨‹å¯åŠ¨æˆåŠŸ",
  "data": "process-instance-id-12345"
}
```

**âš ï¸ æ³¨æ„**ï¼š
- å¦‚æœè¿”å›é”™è¯¯è¯´æµç¨‹å®šä¹‰ä¸å­˜åœ¨ï¼Œè¿™æ˜¯æ­£å¸¸çš„
- éœ€è¦å…ˆéƒ¨ç½²æµç¨‹å®šä¹‰æ–‡ä»¶ï¼ˆ.bpmn20.xmlï¼‰
- å½“å‰ç³»ç»Ÿä¸­æœ‰ `simple-process.bpmn20.xml` ä½†å¯èƒ½æœªéƒ¨ç½²

---

### 5. æŸ¥è¯¢æµç¨‹å®ä¾‹åˆ—è¡¨

```bash
# æŸ¥è¯¢æ‰€æœ‰æµç¨‹å®ä¾‹
curl -X GET 'http://localhost:9099/api/process/instances?pageNum=1&pageSize=10' \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# æŸ¥è¯¢æŒ‡å®šç”¨æˆ·å¯åŠ¨çš„æµç¨‹
curl -X GET 'http://localhost:9099/api/process/instances?startUser=admin&pageNum=1&pageSize=10' \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# æŸ¥è¯¢è¿è¡Œä¸­çš„æµç¨‹
curl -X GET 'http://localhost:9099/api/process/instances?state=active&pageNum=1&pageSize=10' \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "list": [
      {
        "instanceId": "12345",
        "processKey": "simple-process",
        "businessKey": "TEST001",
        "processName": "ç®€å•æµç¨‹",
        "status": "RUNNING",
        "startTime": "2025-11-05T16:30:00",
        "startUser": "admin"
      }
    ],
    "total": 1,
    "pageNum": 1,
    "pageSize": 10,
    "totalPages": 1
  }
}
```

---

### 6. æŸ¥è¯¢å•ä¸ªæµç¨‹å®ä¾‹

```bash
curl -X GET http://localhost:9099/api/process/instance/YOUR_INSTANCE_ID \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "instanceId": "12345",
    "processDefinitionId": "simple-process:1:123",
    "processKey": "simple-process",
    "businessKey": "TEST001",
    "processName": "ç®€å•æµç¨‹",
    "status": "RUNNING",
    "startTime": "2025-11-05T16:30:00",
    "startUser": "admin",
    "variables": {
      "applicant": "admin",
      "reason": "æµ‹è¯•å¯åŠ¨æµç¨‹"
    }
  }
}
```

---

### 7. æŒ‚èµ·æµç¨‹å®ä¾‹

```bash
curl -X POST http://localhost:9099/api/process/instance/YOUR_INSTANCE_ID/suspend \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æµç¨‹å·²æŒ‚èµ·"
}
```

---

### 8. æ¿€æ´»æµç¨‹å®ä¾‹

```bash
curl -X POST http://localhost:9099/api/process/instance/YOUR_INSTANCE_ID/activate \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æµç¨‹å·²æ¿€æ´»"
}
```

---

### 9. åˆ é™¤æµç¨‹å®ä¾‹

```bash
curl -X DELETE 'http://localhost:9099/api/process/instance/YOUR_INSTANCE_ID?reason=æµ‹è¯•åˆ é™¤' \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æµç¨‹å·²åˆ é™¤"
}
```

---

### 10. æŸ¥è¯¢å¾…åŠä»»åŠ¡åˆ—è¡¨

```bash
# æŸ¥è¯¢æ‰€æœ‰å¾…åŠä»»åŠ¡
curl -X GET 'http://localhost:9099/api/task/list?taskStatus=todo&pageNum=1&pageSize=10' \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„å¾…åŠä»»åŠ¡
curl -X GET 'http://localhost:9099/api/task/list?assignee=admin&taskStatus=todo&pageNum=1&pageSize=10' \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "list": [
      {
        "taskId": "task-123",
        "taskName": "å®¡æ‰¹ä»»åŠ¡",
        "taskKey": "approveTask",
        "processInstanceId": "12345",
        "assignee": "admin",
        "createTime": "2025-11-05T16:31:00",
        "status": "TODO",
        "priority": 50
      }
    ],
    "total": 1,
    "pageNum": 1,
    "pageSize": 10,
    "totalPages": 1
  }
}
```

---

### 11. æŸ¥è¯¢å·²åŠä»»åŠ¡åˆ—è¡¨

```bash
curl -X GET 'http://localhost:9099/api/task/list?assignee=admin&taskStatus=done&pageNum=1&pageSize=10' \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "list": [],
    "total": 0,
    "pageNum": 1,
    "pageSize": 10,
    "totalPages": 0
  }
}
```

---

### 12. æŸ¥è¯¢å•ä¸ªä»»åŠ¡

```bash
curl -X GET http://localhost:9099/api/task/YOUR_TASK_ID \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

---

### 13. å®Œæˆä»»åŠ¡

```bash
curl -X POST http://localhost:9099/api/task/complete \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "taskId": "YOUR_TASK_ID",
    "assignee": "admin",
    "comment": "åŒæ„",
    "variables": {
      "approved": true,
      "approveComment": "å®¡æ‰¹é€šè¿‡"
    }
  }'
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "ä»»åŠ¡å·²å®Œæˆ"
}
```

---

### 14. è®¤é¢†ä»»åŠ¡

```bash
curl -X POST 'http://localhost:9099/api/task/YOUR_TASK_ID/claim?userId=admin' \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "ä»»åŠ¡å·²è®¤é¢†"
}
```

---

### 15. å§”æ´¾ä»»åŠ¡

```bash
curl -X POST 'http://localhost:9099/api/task/YOUR_TASK_ID/delegate?delegateUserId=zhangsan' \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "ä»»åŠ¡å·²å§”æ´¾"
}
```

---

### 16. è½¬åŠä»»åŠ¡

```bash
curl -X POST 'http://localhost:9099/api/task/YOUR_TASK_ID/transfer?targetUserId=lisi' \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "ä»»åŠ¡å·²è½¬åŠ"
}
```

---

## ğŸ” æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šå®Œæ•´æµç¨‹æµ‹è¯•

1. **ç™»å½•ç³»ç»Ÿ**
2. **å¯åŠ¨æµç¨‹**
3. **æŸ¥è¯¢æµç¨‹å®ä¾‹**
4. **æŸ¥è¯¢å¾…åŠä»»åŠ¡**
5. **å®Œæˆä»»åŠ¡**
6. **æŸ¥è¯¢å·²åŠä»»åŠ¡**

### åœºæ™¯2ï¼šæµç¨‹ç®¡ç†æµ‹è¯•

1. **ç™»å½•ç³»ç»Ÿ**
2. **å¯åŠ¨æµç¨‹**
3. **æŒ‚èµ·æµç¨‹**
4. **æŸ¥è¯¢æµç¨‹çŠ¶æ€ï¼ˆåº”ä¸ºSUSPENDEDï¼‰**
5. **æ¿€æ´»æµç¨‹**
6. **æŸ¥è¯¢æµç¨‹çŠ¶æ€ï¼ˆåº”ä¸ºRUNNINGï¼‰**
7. **åˆ é™¤æµç¨‹**

### åœºæ™¯3ï¼šä»»åŠ¡åä½œæµ‹è¯•

1. **ç™»å½•ç³»ç»Ÿ**
2. **å¯åŠ¨æµç¨‹**
3. **è®¤é¢†ä»»åŠ¡**
4. **å§”æ´¾ä»»åŠ¡ç»™å…¶ä»–ç”¨æˆ·**
5. **å…¶ä»–ç”¨æˆ·å®Œæˆä»»åŠ¡**

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼š401 Unauthorized

**åŸå› **ï¼šToken æ— æ•ˆæˆ–è¿‡æœŸ

**è§£å†³**ï¼š
1. é‡æ–°ç™»å½•è·å–æ–°çš„ Token
2. æ£€æŸ¥ Authorization header æ ¼å¼ï¼š`Bearer YOUR_TOKEN`

### é—®é¢˜2ï¼šæµç¨‹å®šä¹‰ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```json
{
  "code": 500,
  "message": "æµç¨‹å®šä¹‰ä¸å­˜åœ¨: simple-process"
}
```

**åŸå› **ï¼šæµç¨‹å®šä¹‰æ–‡ä»¶æœªéƒ¨ç½²åˆ° Flowable å¼•æ“

**è§£å†³**ï¼š
1. ç¡®è®¤ `backend/src/main/resources/processes/` ç›®å½•ä¸‹æœ‰æµç¨‹å®šä¹‰æ–‡ä»¶
2. é‡å¯åº”ç”¨ï¼ˆFlowable ä¼šè‡ªåŠ¨éƒ¨ç½²æµç¨‹ï¼‰
3. æˆ–è€…é€šè¿‡ Flowable API æ‰‹åŠ¨éƒ¨ç½²æµç¨‹

### é—®é¢˜3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³**ï¼š
1. æ£€æŸ¥ MySQL æœåŠ¡æ˜¯å¦å¯åŠ¨
2. éªŒè¯æ•°æ®åº“é…ç½®ï¼š`application-dev.yml`
3. ç¡®è®¤æ•°æ®åº“åç§°ã€ç”¨æˆ·åã€å¯†ç æ­£ç¡®

### é—®é¢˜4ï¼šç«¯å£è¢«å ç”¨

**è§£å†³**ï¼š
1. æ£€æŸ¥ 9099 ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`lsof -i:9099`
2. ä¿®æ”¹ç«¯å£é…ç½®ï¼š`application.yml` ä¸­çš„ `server.port`

---

## ğŸ“Š æµ‹è¯•æ•°æ®

### æµ‹è¯•ç”¨æˆ·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | è¯´æ˜ |
|--------|------|------|------|
| admin | admin123 | ç³»ç»Ÿç®¡ç†å‘˜ | æ‹¥æœ‰æ‰€æœ‰æƒé™ |
| zhangsan | admin123 | æ™®é€šå‘˜å·¥ | å¯ä»¥å‘èµ·å’Œå¤„ç†ä»»åŠ¡ |
| lisi | admin123 | éƒ¨é—¨ç»ç† | å¯ä»¥ç®¡ç†æœ¬éƒ¨é—¨æµç¨‹ |

### æµ‹è¯•æµç¨‹

| æµç¨‹KEY | æµç¨‹åç§° | æ–‡ä»¶ä½ç½® |
|---------|---------|---------|
| simple-process | ç®€å•æµç¨‹ | backend/src/main/resources/processes/simple-process.bpmn20.xml |

---

## ğŸ¯ æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å¯åŠ¨æ­£å¸¸
- [ ] ç™»å½•æ¥å£æ­£å¸¸
- [ ] Token éªŒè¯æ­£å¸¸
- [ ] æµç¨‹å¯åŠ¨æ­£å¸¸
- [ ] æµç¨‹æŸ¥è¯¢æ­£å¸¸
- [ ] æµç¨‹æŒ‚èµ·/æ¿€æ´»æ­£å¸¸
- [ ] æµç¨‹åˆ é™¤æ­£å¸¸
- [ ] ä»»åŠ¡æŸ¥è¯¢æ­£å¸¸
- [ ] ä»»åŠ¡å®Œæˆæ­£å¸¸
- [ ] ä»»åŠ¡è®¤é¢†æ­£å¸¸
- [ ] ä»»åŠ¡å§”æ´¾æ­£å¸¸
- [ ] ä»»åŠ¡è½¬åŠæ­£å¸¸
- [ ] åˆ†é¡µåŠŸèƒ½æ­£å¸¸
- [ ] ç­›é€‰åŠŸèƒ½æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†æ­£å¸¸

---

## ğŸ“– ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åï¼Œæ‚¨å¯ä»¥ï¼š

### âœ… é€‰é¡¹Bï¼šå‰ç«¯å¼€å‘
1. å®ç°ç™»å½•é¡µé¢åŠŸèƒ½
2. å¯¹æ¥åç«¯ API
3. å®ç°æµç¨‹å’Œä»»åŠ¡åˆ—è¡¨é¡µé¢
4. å®ç°ä»»åŠ¡åŠç†åŠŸèƒ½

### âœ… é€‰é¡¹Cï¼šæµç¨‹å†å²æŸ¥è¯¢
1. å®ç°å†å²æµç¨‹å®ä¾‹æŸ¥è¯¢
2. å®ç°æµç¨‹æ‰§è¡Œè½¨è¿¹æŸ¥è¯¢
3. å®ç°æ´»åŠ¨å†å²è®°å½•æŸ¥è¯¢
4. å®ç°æµç¨‹å›¾å¯è§†åŒ–

---

## ğŸ’¡ æç¤º

1. **ä½¿ç”¨ Postman**ï¼šå¯ä»¥å¯¼å…¥æµ‹è¯•ç”¨ä¾‹åˆ° Postman ä¸­ï¼Œæ›´æ–¹ä¾¿ç®¡ç†å’Œæµ‹è¯•
2. **æŸ¥çœ‹æ—¥å¿—**ï¼šåç«¯æ—¥å¿—ä¼šæ˜¾ç¤ºè¯¦ç»†çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯
3. **æ•°æ®åº“æŸ¥çœ‹**ï¼šå¯ä»¥ä½¿ç”¨ IDEA Database å·¥å…·æˆ– MySQL Workbench æŸ¥çœ‹æ•°æ®
4. **Druid ç›‘æ§**ï¼šè®¿é—® http://localhost:9099/druid/ æŸ¥çœ‹ SQL æ‰§è¡Œæƒ…å†µ

---

**Happy Testing! ğŸ‰**

